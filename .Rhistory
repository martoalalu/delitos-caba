group_by(id.y, nomoficial) %>%
summarise(cant_delitos=n())
st_geometry(calles_delitos_q) <- NULL
#Renombramos para poder hacer el join
calles_delitos_q <- calles_delitos_q %>%
rename(id=id.y)
calles <- left_join(calles,calles_delitos_q)
calles <- calles %>%
mutate(cant_delitos_log=log(cant_delitos))
ggplot()+
geom_sf(data = calles, aes(color=cant_delitos_log), size=0.7)+
labs(title = "Cantidad de delitos por calle",
subtitle="Ciudad Autónoma de Buenos Aires",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/")+
scale_colour_viridis_c(option="inferno",guide=FALSE)+
dark_theme_void()
library(leaflet)
binpal <- colorBin("viridis", calles$cant_delitos_log, 6, pretty = FALSE)
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "15px",
direction = "auto"))%>%
addLegend("bottomleft", pal = binpal, values = ~cant_delitos,title = "delitos",labFormat = labelFormat(suffix = "%"),opacity = 1.0)%>%
addScaleBar(position = c("bottomright"), options = scaleBarOptions(maxWidth = 100, metric = TRUE, imperial = FALSE,                                                                    updateWhenIdle = TRUE))
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "15px",
direction = "auto"))%>%
addLegend("bottomleft", pal = binpal, values = ~cant_delitos,title = "delitos",labFormat = labelFormat(suffix = "%"),opacity = 1.0)%>%
addScaleBar(position = c("bottomright"), options = scaleBarOptions(maxWidth = 100, metric = TRUE, imperial = FALSE,updateWhenIdle = TRUE))
leaflet(calles) %>%
addProviderTiles(providers$CartoDB.DarkMatter) %>%
addPolylines(color = ~binpal(cant_delitos_log), weight = 1, smoothFactor = 0.5,
opacity = 1.0, fillOpacity = 0.65,highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = cant_delitos,
labelOptions = labelOptions(textsize = "15px",direction = "auto"))
leaflet(calles) %>%
addProviderTiles(providers$CartoDB.DarkMatter) %>%
addPolylines(color = ~binpal(cant_delitos_log), weight = 1, smoothFactor = 0.5,
opacity = 1.0, fillOpacity = 0.65,highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE), label = cant_delitos_log,
labelOptions = labelOptions(textsize = "15px",direction = "auto"))
leaflet(calles) %>%
addProviderTiles(providers$CartoDB.DarkMatter) %>%
addPolylines(color = ~binpal(cant_delitos_log), weight = 1, smoothFactor = 0.5,
opacity = 1.0, fillOpacity = 0.65,highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE)))
leaflet(calles) %>%
addProviderTiles(providers$CartoDB.DarkMatter) %>%
addPolylines(color = ~binpal(cant_delitos_log), weight = 1, smoothFactor = 0.5,
opacity = 1.0, fillOpacity = 0.65,highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE))
leaflet(calles) %>%
addProviderTiles(providers$CartoDB.DarkMatter) %>%
addPolylines(color = ~binpal(cant_delitos_log), weight = 2, smoothFactor = 0.5,
opacity = 1.0, fillOpacity = 0.65,highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE))
ggplot()+
geom_histogram(data=calles,aes(x=cant_delitos))
ggplot()+
geom_histogram(data=calles,aes(x=cant_delitos_log))
binpal <- colorBin("inferno", calles$cant_delitos_log, 6, pretty = FALSE)
leaflet(calles) %>%
addProviderTiles(providers$CartoDB.DarkMatter) %>%
addPolylines(color = ~binpal(cant_delitos_log), weight = 2, smoothFactor = 0.5,
opacity = 1.0, fillOpacity = 0.65,highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE))
binpal <- colorBin("viridis", calles$cant_delitos_log, 6, pretty = FALSE)
leaflet(calles) %>%
addProviderTiles(providers$CartoDB.DarkMatter) %>%
addPolylines(color = ~binpal(cant_delitos_log), weight = 1.5, smoothFactor = 0.5,
opacity = 1.0, fillOpacity = 0.65,highlightOptions = highlightOptions(color = "white", weight = 2,
bringToFront = TRUE))
ggplot()+
geom_sf(data = calles, aes(color=cant_delitos_log), size=0.7)+
labs(title = "Cantidad de delitos por calle",
subtitle="Ciudad Autónoma de Buenos Aires",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/")+
scale_colour_viridis_c(option="inferno",guide=FALSE)+
dark_theme_void()
ggplot(data=calles_delitos_q_unique[1:30,],
aes(x=reorder(nomoficial, total_delitos),
y=total_delitos,
fill=factor(nomoficial)))+
geom_bar(width=0.75,
stat='identity',
position='stack')+
geom_text(size=3.5, color="black",aes(x = nomoficial,
y = total_delitos + 400, label = total_delitos))+
coord_flip() +
labs(title = "30 calles con mayor cantidad de delitos",
subtitle = "Ciudad Autónoma de Buenos Aires, 2017",
x = "Calle",
y = "Cantidad")+
guides(fill=FALSE)
calles_delitos_q_unique <- calles_delitos_q %>%
group_by(nomoficial) %>%
summarise(total_delitos=sum(cant_delitos)) %>%
arrange(desc(total_delitos))
ggplot(data=calles_delitos_q_unique[1:30,],
aes(x=reorder(nomoficial, total_delitos),
y=total_delitos,
fill=factor(nomoficial)))+
geom_bar(width=0.75,
stat='identity',
position='stack')+
geom_text(size=3.5, color="black",aes(x = nomoficial,
y = total_delitos + 400, label = total_delitos))+
coord_flip() +
labs(title = "30 calles con mayor cantidad de delitos",
subtitle = "Ciudad Autónoma de Buenos Aires, 2017",
x = "Calle",
y = "Cantidad")+
guides(fill=FALSE)
View(head(delitos_caba))
View(delitos)
delitos <- fread("https://raw.githubusercontent.com/martoalalu/delitos-caba/master/data/delitos.csv")
delitos_geo <- delitos %>%
filter(!is.na(longitud), !is.na(latitud)) %>%
filter(longitud != 0) %>%
st_as_sf(coords = c("longitud", "latitud"), crs = 4326) %>%
mutate(anio=year(fecha))
View(delitos_geo)
bbox <- c(-58.546686, #Asignar coordenadas de los límites del bounding box de la Ciudad
-34.711145,
-58.329097,
-34.529156)
CABA <- get_stamenmap(bbox = bbox, #Descargar mapa
maptype = "toner-lite",
zoom=13)
#Delitos facetados por anio
ggmap(CABA) +
stat_density_2d(data = delitos,
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Distribución de delitos",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void()+
facet_wrap(~anio)
delitos <- delitos %>%
mutate(anio=year(fecha))
#Delitos facetados por anio
ggmap(CABA) +
stat_density_2d(data = delitos,
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Distribución de delitos",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void()+
facet_wrap(~anio)
delitos %>%
count(anio)
delitos_anio <- delitos %>%
count(anio)
sum(delitos_anio$n)
delitos_anio <- delitos_anio %>%
mutate(pct=n/sum(delitos_anio$n))
delitos_anio
Vire(filter(delitos, delitos$anio==2016))
View(filter(delitos, delitos$anio==2016))
ggplot(data=filter(delitos, delitos$anio==2016))+
geom_point(x=long, y=lat)
ggplot(data=filter(delitos, delitos$anio==2016))+
geom_point(x=longitud, y=latitud)
ggplot(data=filter(delitos, delitos$anio==2016))+
geom_point(aes(x=longitud, y=latitud))
ggplot(data=filter(delitos, delitos$anio==2016))+
geom_point(aes(x=longitud, y=latitud),color="red")
ggplot(data=filter(delitos, delitos$anio==2016 | delitos$latitud>0))+
geom_point(aes(x=longitud, y=latitud),color="red")
ggplot(data=filter(delitos, delitos$anio==2016 & delitos$latitud>0))+
geom_point(aes(x=longitud, y=latitud),color="red")
ggplot(data=filter(delitos, delitos$anio==2016 & delitos$latitud>0))+
geom_point(aes(x=longitud, y=latitud),color="red")
ggplot(data=filter(delitos, delitos$anio==2016 | delitos$latitud>0))+
geom_point(aes(x=longitud, y=latitud),color="red")
ggplot(data=filter(delitos, delitos$anio==2016 | delitos$latitud!=0))+
geom_point(aes(x=longitud, y=latitud),color="red")
rm(delitos_geo)
delitos_geo <- delitos %>%
filter(!is.na(longitud), !is.na(latitud)) %>%
filter(longitud != 0) %>%
st_as_sf(coords = c("longitud", "latitud"), crs = 4326)
#Nos quedamos con los delitos que están dentro de CABA
delitos_caba <- delitos_geo[st_within(delitos_geo, barrios) %>% lengths > 0,]
radios <- read_sf("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/informacion-censal-por-radio/caba_radios_censales.geojson")
#Poblacion por barrio
barrios <- radios %>%
group_by(BARRIO) %>%
summarise(poblacion_barrio=sum(POBLACION)) %>%
clean_names()
#Delitos por barrio
delitos_barrio <- delitos %>%
group_by(barrio) %>%
summarise(cant_delitos=n())
barrios <- barrios %>%
left_join(delitos_barrio)
#Agregamos cantidad de delitos por habitante
barrios <- barrios %>%
mutate(delitos_hab=cant_delitos/poblacion_barrio)
calles <- read_sf("C:/Users/20332842324/Desktop/callejero.shp")
#Paso a misma proyección que delitos
calles <- st_transform(calles,crs = 4326)
#Nos quedamos con los delitos que están dentro de CABA
delitos_caba <- delitos_geo[st_within(delitos_geo, barrios) %>% lengths > 0,]
ggplot(data=filter(delitos_geo, delitos$anio==2016))+
geom_sf(color="red")
ggplot()+
geom_sf(data=filter(delitos_geo, delitos$anio==2016))
ggplot()+
geom_sf(data=filter(delitos_geo, delitos_geo$anio==2016))
ggpubr::ggarrange(ncol=2, nrow=2,
ggmap(CABA) +
stat_density_2d(data = filter(delitos_geo, delitos_geo$anio==2016),
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Delitos 2016",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void(),
ggmap(CABA) +
stat_density_2d(data = filter(delitos_geo, delitos_geo$anio==2017),
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Delitos 2017",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void(),
ggmap(CABA) +
stat_density_2d(data = filter(delitos_geo, delitos_geo$anio==2018),
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Delitos 2018",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void()
)
prueba<-st_coordinates(delitos_caba)
View(prueba)
st_coordinates(delitos_caba)[1]
st_coordinates(delitos_caba)[1,]
st_coordinates(delitos_caba)[,1]
delitos <- delitos %>%
mutate(long=st_coordinates(delitos_caba)[,1],
lat=st_coordinates(delitos_caba)[,2])
delitos_caba_2 <- delitos %>%
mutate(long=st_coordinates(delitos_caba)[,1],
lat=st_coordinates(delitos_caba)[,2])
View(delitos_caba)
delitos_caba_2 <- delitos %>%
mutate(long=st_coordinates(delitos_caba)[,1],
lat=st_coordinates(delitos_caba)[,2],
anio=anio)
delitos_caba_2 <- delitos_caba %>%
mutate(long=st_coordinates(delitos_caba)[,1],
lat=st_coordinates(delitos_caba)[,2],
anio=anio)
View(delitos_caba_2)
ggpubr::ggarrange(ncol=2, nrow=2,
ggmap(CABA) +
stat_density_2d(data = filter(delitos_geo, delitos_geo$anio==2016),
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Delitos 2016",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void(),
ggmap(CABA) +
stat_density_2d(data = filter(delitos_geo, delitos_geo$anio==2017),
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Delitos 2017",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void(),
ggmap(CABA) +
stat_density_2d(data = filter(delitos_geo, delitos_geo$anio==2018),
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Delitos 2018",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void()
)
ggpubr::ggarrange(ncol=2, nrow=2,
ggmap(CABA) +
stat_density_2d(data = filter(delitos_caba_2, delitos_caba_2$anio==2016),
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Delitos 2016",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void(),
ggmap(CABA) +
stat_density_2d(data = filter(delitos_caba_2, delitos_caba_2$anio==2017),
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Delitos 2017",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void(),
ggmap(CABA) +
stat_density_2d(data = filter(delitos_caba_2, delitos_caba_2$anio==2018),
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Delitos 2018",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void()
)
rm(delitos_caba_2)
#Extraigo las coordenadas
delitos_caba_2 <- delitos_caba %>%
mutate(longitud=st_coordinates(delitos_caba)[,1],
latitud=st_coordinates(delitos_caba)[,2],
anio=anio)
ggpubr::ggarrange(ncol=2, nrow=2,
ggmap(CABA) +
stat_density_2d(data = filter(delitos_caba_2, delitos_caba_2$anio==2016),
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Delitos 2016",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void(),
ggmap(CABA) +
stat_density_2d(data = filter(delitos_caba_2, delitos_caba_2$anio==2017),
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Delitos 2017",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void(),
ggmap(CABA) +
stat_density_2d(data = filter(delitos_caba_2, delitos_caba_2$anio==2018),
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Delitos 2018",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void()
)
#Delitos facetados por anio
ggmap(CABA) +
stat_density_2d(data = delitos,
aes(x = longitud, y = latitud,
fill = stat(level)), alpha = 0.6, geom = "polygon") +
labs(title="Distribución de delitos",
subtitle="Ciudad Autónoma de Buenos Aires",
x="",
y="",
caption= "Fuente de datos: https://mapa.seguridadciudad.gob.ar/",
fill="Nivel")+
scale_fill_distiller(palette = "Spectral")+
theme_void()+
facet_wrap(~anio)
caba <- st_read("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/perimetro/caba-perimetro.geojson")
#Creamos grilla
grilla<-st_make_grid(caba, cellsize = 0.003)
#Vemos como queda
ggplot() +
geom_sf(data = caba, fill=NA)+
geom_sf(data=grilla, fill=NA)
grilla <- st_sf(grilla)
grilla <- mutate(grilla, id=seq(1,3960))
grilla_caba <- st_intersection(grilla, caba)
plot(grilla_caba)
plot(grilla_caba)[1]
ggplot()+
geom_sf(data=grilla_Caba)
ggplot()+
geom_sf(data=grilla_caba)
delitos_robo <- delitos_caba %>%
filter(tipo_delito =="Robo (Con violencia)")
ggplot()+
geom_sf(data=grilla_caba)+
geom_sf(data=delitos_robo)
delitos_robo <- delitos_robo %>%
st_join(grilla_caba)
delitos_robo_grilla <- delitos_robo %>%
st_set_geometry(NULL) %>%
group_by(id) %>%
summarise(robos = n())
View(delitos_robo)
delitos_robo_grilla <- delitos_robo %>%
st_set_geometry(NULL) %>%
group_by(id.y) %>%
summarise(robos = n())
View(delitos_robo_grilla)
ggplot() +
geom_histogram(data = delitos_robo_grilla, aes(delitos))
ggplot() +
geom_histogram(data = delitos_robo_grilla, aes(delitos))
View(delitos_robo_grilla)
ggplot() +
geom_histogram(data = delitos_robo_grilla, x=delitos)
ggplot() +
geom_histogram(data = delitos_robo_grilla, aes(x=delitos))
typeof(delitos_robo_grilla$delitos)
ggplot() +
geom_histogram(data = delitos_robo_grilla, aes(robos))
grilla_caba <- grilla_caba %>%
left_join(delitos_robo_grilla)
grilla_caba <- grilla_caba %>%
mutate(robos = ifelse(is.na(robos), 0, robos))
grilla_caba <- grilla_caba %>%
mutate(robo = ifelse(is.na(robos), 0, robos))
View(grilla_caba)
grilla_caba <- grilla_caba %>%
left_join(delitos_robo_grilla)
View(delitos_robo_grilla)
grilla_caba <- grilla_caba %>%
left_join(delitos_robo_grilla, by=c(id,id.y))
grilla_caba <- grilla_caba %>%
left_join(delitos_robo_grilla, by=c("id"="id.y"))
grilla_caba <- grilla_caba %>%
mutate(robo = ifelse(is.na(robos), 0, robos))
ggplot()+
geom_sf(data=grilla_caba, aes(color=robo))
View(grilla_caba)
ggplot()+
geom_sf(data=grilla_caba, aes(fill=robo))
library(spdep)
grilla_caba <- st_as_sf(grilla_caba)
sp.matrix <- poly2nb(as(grilla_caba, "Spatial"), queen=TRUE)
summary(sp.matrix)
sp.weights <- nb2listw(sp.matrix, style='W')
moran.mc(grilla_caba$robo, listw = sp.weights, nsim = 999)
#Distancia a comisarias
grilla_caba_c <- st_point_on_surface(grilla_caba)
View(grilla_caba_c)
ggplot()+
geom_sf(data=grilla_caba_c, aes(color=robo))
comisarias<-read.csv("http://cdn.buenosaires.gob.ar/datosabiertos/datasets/comisarias-policia-de-la-ciudad/comisarias-policia-de-la-ciudad.csv")
comisarias <- comisarias %>%
filter(!is.na(long), !is.na(lat)) %>%
st_as_sf(coords = c("long", "lat"), crs = 4326)
ggplot()+
geom_sf(data=grilla_caba_c, aes(color=robo))+
geom_sf(data=comisarias)
ggplot()+
geom_sf(data=grilla_caba_c, aes(color=robo))+
geom_sf(data=comisarias, color="red", size=5)
#Distancia comisarias a centroides delitos
comisarias_grilla <- st_join(comisarias, grilla_caba_c, st_nearest_feature)
View(comisarias_grilla)
#Distancia comisarias a centroides delitos
comisarias_grilla <- st_join(grilla_caba_c, comisarias, st_nearest_feature)
View(comisarias_grilla)
#Agregamos una columna con la distancia y lo pasamos a numero
comisarias_grilla <- comisarias_grilla %>%
mutate(distancia=st_distance(grilla_caba_c, comisarias[st_nearest_feature(grilla_caba_c, comisarias),], by_element = TRUE)) %>%
mutate(distancia=as.numeric(distancia))
View(comisarias_grilla)
modelo<- lm(robos~distancia, data=comisarias_grilla)
summary(modelo)
